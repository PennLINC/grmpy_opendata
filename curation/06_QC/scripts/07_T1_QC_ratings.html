
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T1 QC Ratings</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 16px; }
    h1 { font-size: 20px; margin: 0 0 12px 0; }
    .controls { display: flex; gap: 8px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 8px; background: #fff; }
    .header { display: flex; align-items: baseline; justify-content: space-between; gap: 8px; margin-bottom: 8px; }
    .views { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px; }
    .view { display: flex; flex-direction: column; gap: 6px; }
    .view img { width: 100%; height: auto; display: block; border: 1px solid #eee; border-radius: 4px; }
    .rating { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; }
    .muted { color: #666; font-size: 12px; }
    .search { padding: 6px 10px; border: 1px solid #ccc; border-radius: 6px; min-width: 260px; }
    button { padding: 6px 10px; border: 1px solid #aaa; border-radius: 6px; background: #f7f7f7; cursor: pointer; }
    button.primary { background: #0b5; color: #fff; border-color: #0a4; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>
  <script>
    const DATA = [{"sub": "sub-19977", "ses": "ses-1", "images": {"S1": "assets/sub-19977_ses-1_S1.png", "S3": "assets/sub-19977_ses-1_S3.png", "A2": "assets/sub-19977_ses-1_A2.png", "A3": "assets/sub-19977_ses-1_A3.png"}}, {"sub": "sub-19981", "ses": "ses-1", "images": {"S1": "assets/sub-19981_ses-1_S1.png", "S3": "assets/sub-19981_ses-1_S3.png", "A2": "assets/sub-19981_ses-1_A2.png", "A3": "assets/sub-19981_ses-1_A3.png"}}, {"sub": "sub-20011", "ses": "ses-1", "images": {"S1": "assets/sub-20011_ses-1_S1.png", "S3": "assets/sub-20011_ses-1_S3.png", "A2": "assets/sub-20011_ses-1_A2.png", "A3": "assets/sub-20011_ses-1_A3.png"}}, {"sub": "sub-20017", "ses": "ses-1", "images": {"S1": "assets/sub-20017_ses-1_S1.png", "S3": "assets/sub-20017_ses-1_S3.png", "A2": "assets/sub-20017_ses-1_A2.png", "A3": "assets/sub-20017_ses-1_A3.png"}}, {"sub": "sub-20120", "ses": "ses-1", "images": {"S1": "assets/sub-20120_ses-1_S1.png", "S3": "assets/sub-20120_ses-1_S3.png", "A2": "assets/sub-20120_ses-1_A2.png", "A3": "assets/sub-20120_ses-1_A3.png"}}, {"sub": "sub-20151", "ses": "ses-1", "images": {"S1": "assets/sub-20151_ses-1_S1.png", "S3": "assets/sub-20151_ses-1_S3.png", "A2": "assets/sub-20151_ses-1_A2.png", "A3": "assets/sub-20151_ses-1_A3.png"}}, {"sub": "sub-20153", "ses": "ses-1", "images": {"S1": "assets/sub-20153_ses-1_S1.png", "S3": "assets/sub-20153_ses-1_S3.png", "A2": "assets/sub-20153_ses-1_A2.png", "A3": "assets/sub-20153_ses-1_A3.png"}}, {"sub": "sub-20189", "ses": "ses-1", "images": {"S1": "assets/sub-20189_ses-1_S1.png", "S3": "assets/sub-20189_ses-1_S3.png", "A2": "assets/sub-20189_ses-1_A2.png", "A3": "assets/sub-20189_ses-1_A3.png"}}, {"sub": "sub-20197", "ses": "ses-1", "images": {"S1": "assets/sub-20197_ses-1_S1.png", "S3": "assets/sub-20197_ses-1_S3.png", "A2": "assets/sub-20197_ses-1_A2.png", "A3": "assets/sub-20197_ses-1_A3.png"}}, {"sub": "sub-20247", "ses": "ses-1", "images": {"S1": "assets/sub-20247_ses-1_S1.png", "S3": "assets/sub-20247_ses-1_S3.png", "A2": "assets/sub-20247_ses-1_A2.png", "A3": "assets/sub-20247_ses-1_A3.png"}}, {"sub": "sub-20313", "ses": "ses-1", "images": {"S1": "assets/sub-20313_ses-1_S1.png", "S3": "assets/sub-20313_ses-1_S3.png", "A2": "assets/sub-20313_ses-1_A2.png", "A3": "assets/sub-20313_ses-1_A3.png"}}, {"sub": "sub-20320", "ses": "ses-1", "images": {"S1": "assets/sub-20320_ses-1_S1.png", "S3": "assets/sub-20320_ses-1_S3.png", "A2": "assets/sub-20320_ses-1_A2.png", "A3": "assets/sub-20320_ses-1_A3.png"}}, {"sub": "sub-20322", "ses": "ses-1", "images": {"S1": "assets/sub-20322_ses-1_S1.png", "S3": "assets/sub-20322_ses-1_S3.png", "A2": "assets/sub-20322_ses-1_A2.png", "A3": "assets/sub-20322_ses-1_A3.png"}}, {"sub": "sub-20325", "ses": "ses-1", "images": {"S1": "assets/sub-20325_ses-1_S1.png", "S3": "assets/sub-20325_ses-1_S3.png", "A2": "assets/sub-20325_ses-1_A2.png", "A3": "assets/sub-20325_ses-1_A3.png"}}, {"sub": "sub-20326", "ses": "ses-1", "images": {"S1": "assets/sub-20326_ses-1_S1.png", "S3": "assets/sub-20326_ses-1_S3.png", "A2": "assets/sub-20326_ses-1_A2.png", "A3": "assets/sub-20326_ses-1_A3.png"}}, {"sub": "sub-20327", "ses": "ses-1", "images": {"S1": "assets/sub-20327_ses-1_S1.png", "S3": "assets/sub-20327_ses-1_S3.png", "A2": "assets/sub-20327_ses-1_A2.png", "A3": "assets/sub-20327_ses-1_A3.png"}}, {"sub": "sub-20362", "ses": "ses-1", "images": {"S1": "assets/sub-20362_ses-1_S1.png", "S3": "assets/sub-20362_ses-1_S3.png", "A2": "assets/sub-20362_ses-1_A2.png", "A3": "assets/sub-20362_ses-1_A3.png"}}, {"sub": "sub-20386", "ses": "ses-1", "images": {"S1": "assets/sub-20386_ses-1_S1.png", "S3": "assets/sub-20386_ses-1_S3.png", "A2": "assets/sub-20386_ses-1_A2.png", "A3": "assets/sub-20386_ses-1_A3.png"}}, {"sub": "sub-20387", "ses": "ses-1", "images": {"S1": "assets/sub-20387_ses-1_S1.png", "S3": "assets/sub-20387_ses-1_S3.png", "A2": "assets/sub-20387_ses-1_A2.png", "A3": "assets/sub-20387_ses-1_A3.png"}}, {"sub": "sub-20461", "ses": "ses-1", "images": {"S1": "assets/sub-20461_ses-1_S1.png", "S3": "assets/sub-20461_ses-1_S3.png", "A2": "assets/sub-20461_ses-1_A2.png", "A3": "assets/sub-20461_ses-1_A3.png"}}, {"sub": "sub-20589", "ses": "ses-1", "images": {"S1": "assets/sub-20589_ses-1_S1.png", "S3": "assets/sub-20589_ses-1_S3.png", "A2": "assets/sub-20589_ses-1_A2.png", "A3": "assets/sub-20589_ses-1_A3.png"}}, {"sub": "sub-20649", "ses": "ses-1", "images": {"S1": "assets/sub-20649_ses-1_S1.png", "S3": "assets/sub-20649_ses-1_S3.png", "A2": "assets/sub-20649_ses-1_A2.png", "A3": "assets/sub-20649_ses-1_A3.png"}}, {"sub": "sub-20699", "ses": "ses-1", "images": {"S1": "assets/sub-20699_ses-1_S1.png", "S3": "assets/sub-20699_ses-1_S3.png", "A2": "assets/sub-20699_ses-1_A2.png", "A3": "assets/sub-20699_ses-1_A3.png"}}, {"sub": "sub-20809", "ses": "ses-1", "images": {"S1": "assets/sub-20809_ses-1_S1.png", "S3": "assets/sub-20809_ses-1_S3.png", "A2": "assets/sub-20809_ses-1_A2.png", "A3": "assets/sub-20809_ses-1_A3.png"}}, {"sub": "sub-20888", "ses": "ses-1", "images": {"S1": "assets/sub-20888_ses-1_S1.png", "S3": "assets/sub-20888_ses-1_S3.png", "A2": "assets/sub-20888_ses-1_A2.png", "A3": "assets/sub-20888_ses-1_A3.png"}}, {"sub": "sub-20940", "ses": "ses-1", "images": {"S1": "assets/sub-20940_ses-1_S1.png", "S3": "assets/sub-20940_ses-1_S3.png", "A2": "assets/sub-20940_ses-1_A2.png", "A3": "assets/sub-20940_ses-1_A3.png"}}, {"sub": "sub-20941", "ses": "ses-1", "images": {"S1": "assets/sub-20941_ses-1_S1.png", "S3": "assets/sub-20941_ses-1_S3.png", "A2": "assets/sub-20941_ses-1_A2.png", "A3": "assets/sub-20941_ses-1_A3.png"}}, {"sub": "sub-20949", "ses": "ses-1", "images": {"S1": "assets/sub-20949_ses-1_S1.png", "S3": "assets/sub-20949_ses-1_S3.png", "A2": "assets/sub-20949_ses-1_A2.png", "A3": "assets/sub-20949_ses-1_A3.png"}}, {"sub": "sub-20963", "ses": "ses-1", "images": {"S1": "assets/sub-20963_ses-1_S1.png", "S3": "assets/sub-20963_ses-1_S3.png", "A2": "assets/sub-20963_ses-1_A2.png", "A3": "assets/sub-20963_ses-1_A3.png"}}, {"sub": "sub-20974", "ses": "ses-1", "images": {"S1": "assets/sub-20974_ses-1_S1.png", "S3": "assets/sub-20974_ses-1_S3.png", "A2": "assets/sub-20974_ses-1_A2.png", "A3": "assets/sub-20974_ses-1_A3.png"}}, {"sub": "sub-20981", "ses": "ses-1", "images": {"S1": "assets/sub-20981_ses-1_S1.png", "S3": "assets/sub-20981_ses-1_S3.png", "A2": "assets/sub-20981_ses-1_A2.png", "A3": "assets/sub-20981_ses-1_A3.png"}}, {"sub": "sub-21016", "ses": "ses-1", "images": {"S1": "assets/sub-21016_ses-1_S1.png", "S3": "assets/sub-21016_ses-1_S3.png", "A2": "assets/sub-21016_ses-1_A2.png", "A3": "assets/sub-21016_ses-1_A3.png"}}, {"sub": "sub-21056", "ses": "ses-1", "images": {"S1": "assets/sub-21056_ses-1_S1.png", "S3": "assets/sub-21056_ses-1_S3.png", "A2": "assets/sub-21056_ses-1_A2.png", "A3": "assets/sub-21056_ses-1_A3.png"}}, {"sub": "sub-21059", "ses": "ses-1", "images": {"S1": "assets/sub-21059_ses-1_S1.png", "S3": "assets/sub-21059_ses-1_S3.png", "A2": "assets/sub-21059_ses-1_A2.png", "A3": "assets/sub-21059_ses-1_A3.png"}}, {"sub": "sub-21085", "ses": "ses-1", "images": {"S1": "assets/sub-21085_ses-1_S1.png", "S3": "assets/sub-21085_ses-1_S3.png", "A2": "assets/sub-21085_ses-1_A2.png", "A3": "assets/sub-21085_ses-1_A3.png"}}, {"sub": "sub-80557", "ses": "ses-1", "images": {"S1": "assets/sub-80557_ses-1_S1.png", "S3": "assets/sub-80557_ses-1_S3.png", "A2": "assets/sub-80557_ses-1_A2.png", "A3": "assets/sub-80557_ses-1_A3.png"}}, {"sub": "sub-80688", "ses": "ses-1", "images": {"S1": "assets/sub-80688_ses-1_S1.png", "S3": "assets/sub-80688_ses-1_S3.png", "A2": "assets/sub-80688_ses-1_A2.png", "A3": "assets/sub-80688_ses-1_A3.png"}}, {"sub": "sub-81725", "ses": "ses-1", "images": {"S1": "assets/sub-81725_ses-1_S1.png", "S3": "assets/sub-81725_ses-1_S3.png", "A2": "assets/sub-81725_ses-1_A2.png", "A3": "assets/sub-81725_ses-1_A3.png"}}, {"sub": "sub-81760", "ses": "ses-1", "images": {"S1": "assets/sub-81760_ses-1_S1.png", "S3": "assets/sub-81760_ses-1_S3.png", "A2": "assets/sub-81760_ses-1_A2.png", "A3": "assets/sub-81760_ses-1_A3.png"}}, {"sub": "sub-82051", "ses": "ses-1", "images": {"S1": "assets/sub-82051_ses-1_S1.png", "S3": "assets/sub-82051_ses-1_S3.png", "A2": "assets/sub-82051_ses-1_A2.png", "A3": "assets/sub-82051_ses-1_A3.png"}}, {"sub": "sub-82063", "ses": "ses-1", "images": {"S1": "assets/sub-82063_ses-1_S1.png", "S3": "assets/sub-82063_ses-1_S3.png", "A2": "assets/sub-82063_ses-1_A2.png", "A3": "assets/sub-82063_ses-1_A3.png"}}, {"sub": "sub-82492", "ses": "ses-1", "images": {"S1": "assets/sub-82492_ses-1_S1.png", "S3": "assets/sub-82492_ses-1_S3.png", "A2": "assets/sub-82492_ses-1_A2.png", "A3": "assets/sub-82492_ses-1_A3.png"}}, {"sub": "sub-82790", "ses": "ses-1", "images": {"S1": "assets/sub-82790_ses-1_S1.png", "S3": "assets/sub-82790_ses-1_S3.png", "A2": "assets/sub-82790_ses-1_A2.png", "A3": "assets/sub-82790_ses-1_A3.png"}}, {"sub": "sub-83010", "ses": "ses-1", "images": {"S1": "assets/sub-83010_ses-1_S1.png", "S3": "assets/sub-83010_ses-1_S3.png", "A2": "assets/sub-83010_ses-1_A2.png", "A3": "assets/sub-83010_ses-1_A3.png"}}, {"sub": "sub-83372", "ses": "ses-1", "images": {"S1": "assets/sub-83372_ses-1_S1.png", "S3": "assets/sub-83372_ses-1_S3.png", "A2": "assets/sub-83372_ses-1_A2.png", "A3": "assets/sub-83372_ses-1_A3.png"}}, {"sub": "sub-83454", "ses": "ses-1", "images": {"S1": "assets/sub-83454_ses-1_S1.png", "S3": "assets/sub-83454_ses-1_S3.png", "A2": "assets/sub-83454_ses-1_A2.png", "A3": "assets/sub-83454_ses-1_A3.png"}}, {"sub": "sub-83835", "ses": "ses-1", "images": {"S1": "assets/sub-83835_ses-1_S1.png", "S3": "assets/sub-83835_ses-1_S3.png", "A2": "assets/sub-83835_ses-1_A2.png", "A3": "assets/sub-83835_ses-1_A3.png"}}, {"sub": "sub-83999", "ses": "ses-1", "images": {"S1": "assets/sub-83999_ses-1_S1.png", "S3": "assets/sub-83999_ses-1_S3.png", "A2": "assets/sub-83999_ses-1_A2.png", "A3": "assets/sub-83999_ses-1_A3.png"}}, {"sub": "sub-84103", "ses": "ses-1", "images": {"S1": "assets/sub-84103_ses-1_S1.png", "S3": "assets/sub-84103_ses-1_S3.png", "A2": "assets/sub-84103_ses-1_A2.png", "A3": "assets/sub-84103_ses-1_A3.png"}}, {"sub": "sub-84354", "ses": "ses-1", "images": {"S1": "assets/sub-84354_ses-1_S1.png", "S3": "assets/sub-84354_ses-1_S3.png", "A2": "assets/sub-84354_ses-1_A2.png", "A3": "assets/sub-84354_ses-1_A3.png"}}, {"sub": "sub-84688", "ses": "ses-1", "images": {"S1": "assets/sub-84688_ses-1_S1.png", "S3": "assets/sub-84688_ses-1_S3.png", "A2": "assets/sub-84688_ses-1_A2.png", "A3": "assets/sub-84688_ses-1_A3.png"}}, {"sub": "sub-84761", "ses": "ses-1", "images": {"S1": "assets/sub-84761_ses-1_S1.png", "S3": "assets/sub-84761_ses-1_S3.png", "A2": "assets/sub-84761_ses-1_A2.png", "A3": "assets/sub-84761_ses-1_A3.png"}}, {"sub": "sub-84973", "ses": "ses-1", "images": {"S1": "assets/sub-84973_ses-1_S1.png", "S3": "assets/sub-84973_ses-1_S3.png", "A2": "assets/sub-84973_ses-1_A2.png", "A3": "assets/sub-84973_ses-1_A3.png"}}, {"sub": "sub-85083", "ses": "ses-1", "images": {"S1": "assets/sub-85083_ses-1_S1.png", "S3": "assets/sub-85083_ses-1_S3.png", "A2": "assets/sub-85083_ses-1_A2.png", "A3": "assets/sub-85083_ses-1_A3.png"}}, {"sub": "sub-85173", "ses": "ses-1", "images": {"S1": "assets/sub-85173_ses-1_S1.png", "S3": "assets/sub-85173_ses-1_S3.png", "A2": "assets/sub-85173_ses-1_A2.png", "A3": "assets/sub-85173_ses-1_A3.png"}}, {"sub": "sub-102041", "ses": "ses-1", "images": {"S1": "assets/sub-102041_ses-1_S1.png", "S3": "assets/sub-102041_ses-1_S3.png", "A2": "assets/sub-102041_ses-1_A2.png", "A3": "assets/sub-102041_ses-1_A3.png"}}, {"sub": "sub-103679", "ses": "ses-1", "images": {"S1": "assets/sub-103679_ses-1_S1.png", "S3": "assets/sub-103679_ses-1_S3.png", "A2": "assets/sub-103679_ses-1_A2.png", "A3": "assets/sub-103679_ses-1_A3.png"}}, {"sub": "sub-104059", "ses": "ses-1", "images": {"S1": "assets/sub-104059_ses-1_S1.png", "S3": "assets/sub-104059_ses-1_S3.png", "A2": "assets/sub-104059_ses-1_A2.png", "A3": "assets/sub-104059_ses-1_A3.png"}}, {"sub": "sub-104235", "ses": "ses-1", "images": {"S1": "assets/sub-104235_ses-1_S1.png", "S3": "assets/sub-104235_ses-1_S3.png", "A2": "assets/sub-104235_ses-1_A2.png", "A3": "assets/sub-104235_ses-1_A3.png"}}, {"sub": "sub-104785", "ses": "ses-1", "images": {"S1": "assets/sub-104785_ses-1_S1.png", "S3": "assets/sub-104785_ses-1_S3.png", "A2": "assets/sub-104785_ses-1_A2.png", "A3": "assets/sub-104785_ses-1_A3.png"}}, {"sub": "sub-105168", "ses": "ses-1", "images": {"S1": "assets/sub-105168_ses-1_S1.png", "S3": "assets/sub-105168_ses-1_S3.png", "A2": "assets/sub-105168_ses-1_A2.png", "A3": "assets/sub-105168_ses-1_A3.png"}}, {"sub": "sub-105176", "ses": "ses-1", "images": {"S1": "assets/sub-105176_ses-1_S1.png", "S3": "assets/sub-105176_ses-1_S3.png", "A2": "assets/sub-105176_ses-1_A2.png", "A3": "assets/sub-105176_ses-1_A3.png"}}, {"sub": "sub-105309", "ses": "ses-1", "images": {"S1": "assets/sub-105309_ses-1_S1.png", "S3": "assets/sub-105309_ses-1_S3.png", "A2": "assets/sub-105309_ses-1_A2.png", "A3": "assets/sub-105309_ses-1_A3.png"}}, {"sub": "sub-105767", "ses": "ses-1", "images": {"S1": "assets/sub-105767_ses-1_S1.png", "S3": "assets/sub-105767_ses-1_S3.png", "A2": "assets/sub-105767_ses-1_A2.png", "A3": "assets/sub-105767_ses-1_A3.png"}}, {"sub": "sub-105860", "ses": "ses-1", "images": {"S1": "assets/sub-105860_ses-1_S1.png", "S3": "assets/sub-105860_ses-1_S3.png", "A2": "assets/sub-105860_ses-1_A2.png", "A3": "assets/sub-105860_ses-1_A3.png"}}, {"sub": "sub-105979", "ses": "ses-1", "images": {"S1": "assets/sub-105979_ses-1_S1.png", "S3": "assets/sub-105979_ses-1_S3.png", "A2": "assets/sub-105979_ses-1_A2.png", "A3": "assets/sub-105979_ses-1_A3.png"}}, {"sub": "sub-106039", "ses": "ses-1", "images": {"S1": "assets/sub-106039_ses-1_S1.png", "S3": "assets/sub-106039_ses-1_S3.png", "A2": "assets/sub-106039_ses-1_A2.png", "A3": "assets/sub-106039_ses-1_A3.png"}}, {"sub": "sub-106246", "ses": "ses-1", "images": {"S1": "assets/sub-106246_ses-1_S1.png", "S3": "assets/sub-106246_ses-1_S3.png", "A2": "assets/sub-106246_ses-1_A2.png", "A3": "assets/sub-106246_ses-1_A3.png"}}, {"sub": "sub-106331", "ses": "ses-1", "images": {"S1": "assets/sub-106331_ses-1_S1.png", "S3": "assets/sub-106331_ses-1_S3.png", "A2": "assets/sub-106331_ses-1_A2.png", "A3": "assets/sub-106331_ses-1_A3.png"}}, {"sub": "sub-106802", "ses": "ses-1", "images": {"S1": "assets/sub-106802_ses-1_S1.png", "S3": "assets/sub-106802_ses-1_S3.png", "A2": "assets/sub-106802_ses-1_A2.png", "A3": "assets/sub-106802_ses-1_A3.png"}}, {"sub": "sub-106880", "ses": "ses-1", "images": {"S1": "assets/sub-106880_ses-1_S1.png", "S3": "assets/sub-106880_ses-1_S3.png", "A2": "assets/sub-106880_ses-1_A2.png", "A3": "assets/sub-106880_ses-1_A3.png"}}, {"sub": "sub-107055", "ses": "ses-1", "images": {"S1": "assets/sub-107055_ses-1_S1.png", "S3": "assets/sub-107055_ses-1_S3.png", "A2": "assets/sub-107055_ses-1_A2.png", "A3": "assets/sub-107055_ses-1_A3.png"}}, {"sub": "sub-108202", "ses": "ses-1", "images": {"S1": "assets/sub-108202_ses-1_S1.png", "S3": "assets/sub-108202_ses-1_S3.png", "A2": "assets/sub-108202_ses-1_A2.png", "A3": "assets/sub-108202_ses-1_A3.png"}}, {"sub": "sub-109521", "ses": "ses-1", "images": {"S1": "assets/sub-109521_ses-1_S1.png", "S3": "assets/sub-109521_ses-1_S3.png", "A2": "assets/sub-109521_ses-1_A2.png", "A3": "assets/sub-109521_ses-1_A3.png"}}, {"sub": "sub-109646", "ses": "ses-1", "images": {"S1": "assets/sub-109646_ses-1_S1.png", "S3": "assets/sub-109646_ses-1_S3.png", "A2": "assets/sub-109646_ses-1_A2.png", "A3": "assets/sub-109646_ses-1_A3.png"}}, {"sub": "sub-109735", "ses": "ses-1", "images": {"S1": "assets/sub-109735_ses-1_S1.png", "S3": "assets/sub-109735_ses-1_S3.png", "A2": "assets/sub-109735_ses-1_A2.png", "A3": "assets/sub-109735_ses-1_A3.png"}}, {"sub": "sub-110168", "ses": "ses-1", "images": {"S1": "assets/sub-110168_ses-1_S1.png", "S3": "assets/sub-110168_ses-1_S3.png", "A2": "assets/sub-110168_ses-1_A2.png", "A3": "assets/sub-110168_ses-1_A3.png"}}, {"sub": "sub-110354", "ses": "ses-1", "images": {"S1": "assets/sub-110354_ses-1_S1.png", "S3": "assets/sub-110354_ses-1_S3.png", "A2": "assets/sub-110354_ses-1_A2.png", "A3": "assets/sub-110354_ses-1_A3.png"}}, {"sub": "sub-110828", "ses": "ses-1", "images": {"S1": "assets/sub-110828_ses-1_S1.png", "S3": "assets/sub-110828_ses-1_S3.png", "A2": "assets/sub-110828_ses-1_A2.png", "A3": "assets/sub-110828_ses-1_A3.png"}}, {"sub": "sub-112028", "ses": "ses-1", "images": {"S1": "assets/sub-112028_ses-1_S1.png", "S3": "assets/sub-112028_ses-1_S3.png", "A2": "assets/sub-112028_ses-1_A2.png", "A3": "assets/sub-112028_ses-1_A3.png"}}, {"sub": "sub-112061", "ses": "ses-1", "images": {"S1": "assets/sub-112061_ses-1_S1.png", "S3": "assets/sub-112061_ses-1_S3.png", "A2": "assets/sub-112061_ses-1_A2.png", "A3": "assets/sub-112061_ses-1_A3.png"}}, {"sub": "sub-112126", "ses": "ses-1", "images": {"S1": "assets/sub-112126_ses-1_S1.png", "S3": "assets/sub-112126_ses-1_S3.png", "A2": "assets/sub-112126_ses-1_A2.png", "A3": "assets/sub-112126_ses-1_A3.png"}}, {"sub": "sub-112249", "ses": "ses-1", "images": {"S1": "assets/sub-112249_ses-1_S1.png", "S3": "assets/sub-112249_ses-1_S3.png", "A2": "assets/sub-112249_ses-1_A2.png", "A3": "assets/sub-112249_ses-1_A3.png"}}, {"sub": "sub-112332", "ses": "ses-1", "images": {"S1": "assets/sub-112332_ses-1_S1.png", "S3": "assets/sub-112332_ses-1_S3.png", "A2": "assets/sub-112332_ses-1_A2.png", "A3": "assets/sub-112332_ses-1_A3.png"}}, {"sub": "sub-112694", "ses": "ses-1", "images": {"S1": "assets/sub-112694_ses-1_S1.png", "S3": "assets/sub-112694_ses-1_S3.png", "A2": "assets/sub-112694_ses-1_A2.png", "A3": "assets/sub-112694_ses-1_A3.png"}}, {"sub": "sub-113111", "ses": "ses-1", "images": {"S1": "assets/sub-113111_ses-1_S1.png", "S3": "assets/sub-113111_ses-1_S3.png", "A2": "assets/sub-113111_ses-1_A2.png", "A3": "assets/sub-113111_ses-1_A3.png"}}, {"sub": "sub-114709", "ses": "ses-1", "images": {"S1": "assets/sub-114709_ses-1_S1.png", "S3": "assets/sub-114709_ses-1_S3.png", "A2": "assets/sub-114709_ses-1_A2.png", "A3": "assets/sub-114709_ses-1_A3.png"}}, {"sub": "sub-114713", "ses": "ses-1", "images": {"S1": "assets/sub-114713_ses-1_S1.png", "S3": "assets/sub-114713_ses-1_S3.png", "A2": "assets/sub-114713_ses-1_A2.png", "A3": "assets/sub-114713_ses-1_A3.png"}}, {"sub": "sub-114723", "ses": "ses-1", "images": {"S1": "assets/sub-114723_ses-1_S1.png", "S3": "assets/sub-114723_ses-1_S3.png", "A2": "assets/sub-114723_ses-1_A2.png", "A3": "assets/sub-114723_ses-1_A3.png"}}, {"sub": "sub-114935", "ses": "ses-1", "images": {"S1": "assets/sub-114935_ses-1_S1.png", "S3": "assets/sub-114935_ses-1_S3.png", "A2": "assets/sub-114935_ses-1_A2.png", "A3": "assets/sub-114935_ses-1_A3.png"}}, {"sub": "sub-114990", "ses": "ses-1", "images": {"S1": "assets/sub-114990_ses-1_S1.png", "S3": "assets/sub-114990_ses-1_S3.png", "A2": "assets/sub-114990_ses-1_A2.png", "A3": "assets/sub-114990_ses-1_A3.png"}}, {"sub": "sub-115800", "ses": "ses-1", "images": {"S1": "assets/sub-115800_ses-1_S1.png", "S3": "assets/sub-115800_ses-1_S3.png", "A2": "assets/sub-115800_ses-1_A2.png", "A3": "assets/sub-115800_ses-1_A3.png"}}, {"sub": "sub-116019", "ses": "ses-1", "images": {"S1": "assets/sub-116019_ses-1_S1.png", "S3": "assets/sub-116019_ses-1_S3.png", "A2": "assets/sub-116019_ses-1_A2.png", "A3": "assets/sub-116019_ses-1_A3.png"}}, {"sub": "sub-116051", "ses": "ses-1", "images": {"S1": "assets/sub-116051_ses-1_S1.png", "S3": "assets/sub-116051_ses-1_S3.png", "A2": "assets/sub-116051_ses-1_A2.png", "A3": "assets/sub-116051_ses-1_A3.png"}}, {"sub": "sub-116210", "ses": "ses-1", "images": {"S1": "assets/sub-116210_ses-1_S1.png", "S3": "assets/sub-116210_ses-1_S3.png", "A2": "assets/sub-116210_ses-1_A2.png", "A3": "assets/sub-116210_ses-1_A3.png"}}, {"sub": "sub-116354", "ses": "ses-1", "images": {"S1": "assets/sub-116354_ses-1_S1.png", "S3": "assets/sub-116354_ses-1_S3.png", "A2": "assets/sub-116354_ses-1_A2.png", "A3": "assets/sub-116354_ses-1_A3.png"}}, {"sub": "sub-116360", "ses": "ses-1", "images": {"S1": "assets/sub-116360_ses-1_S1.png", "S3": "assets/sub-116360_ses-1_S3.png", "A2": "assets/sub-116360_ses-1_A2.png", "A3": "assets/sub-116360_ses-1_A3.png"}}, {"sub": "sub-117226", "ses": "ses-1", "images": {"S1": "assets/sub-117226_ses-1_S1.png", "S3": "assets/sub-117226_ses-1_S3.png", "A2": "assets/sub-117226_ses-1_A2.png", "A3": "assets/sub-117226_ses-1_A3.png"}}, {"sub": "sub-117397", "ses": "ses-1", "images": {"S1": "assets/sub-117397_ses-1_S1.png", "S3": "assets/sub-117397_ses-1_S3.png", "A2": "assets/sub-117397_ses-1_A2.png", "A3": "assets/sub-117397_ses-1_A3.png"}}, {"sub": "sub-118393", "ses": "ses-1", "images": {"S1": "assets/sub-118393_ses-1_S1.png", "S3": "assets/sub-118393_ses-1_S3.png", "A2": "assets/sub-118393_ses-1_A2.png", "A3": "assets/sub-118393_ses-1_A3.png"}}, {"sub": "sub-118864", "ses": "ses-1", "images": {"S1": "assets/sub-118864_ses-1_S1.png", "S3": "assets/sub-118864_ses-1_S3.png", "A2": "assets/sub-118864_ses-1_A2.png", "A3": "assets/sub-118864_ses-1_A3.png"}}, {"sub": "sub-118990", "ses": "ses-1", "images": {"S1": "assets/sub-118990_ses-1_S1.png", "S3": "assets/sub-118990_ses-1_S3.png", "A2": "assets/sub-118990_ses-1_A2.png", "A3": "assets/sub-118990_ses-1_A3.png"}}, {"sub": "sub-119302", "ses": "ses-1", "images": {"S1": "assets/sub-119302_ses-1_S1.png", "S3": "assets/sub-119302_ses-1_S3.png", "A2": "assets/sub-119302_ses-1_A2.png", "A3": "assets/sub-119302_ses-1_A3.png"}}, {"sub": "sub-119791", "ses": "ses-1", "images": {"S1": "assets/sub-119791_ses-1_S1.png", "S3": "assets/sub-119791_ses-1_S3.png", "A2": "assets/sub-119791_ses-1_A2.png", "A3": "assets/sub-119791_ses-1_A3.png"}}, {"sub": "sub-120217", "ses": "ses-1", "images": {"S1": "assets/sub-120217_ses-1_S1.png", "S3": "assets/sub-120217_ses-1_S3.png", "A2": "assets/sub-120217_ses-1_A2.png", "A3": "assets/sub-120217_ses-1_A3.png"}}, {"sub": "sub-120562", "ses": "ses-1", "images": {"S1": "assets/sub-120562_ses-1_S1.png", "S3": "assets/sub-120562_ses-1_S3.png", "A2": "assets/sub-120562_ses-1_A2.png", "A3": "assets/sub-120562_ses-1_A3.png"}}, {"sub": "sub-121001", "ses": "ses-1", "images": {"S1": "assets/sub-121001_ses-1_S1.png", "S3": "assets/sub-121001_ses-1_S3.png", "A2": "assets/sub-121001_ses-1_A2.png", "A3": "assets/sub-121001_ses-1_A3.png"}}, {"sub": "sub-121050", "ses": "ses-1", "images": {"S1": "assets/sub-121050_ses-1_S1.png", "S3": "assets/sub-121050_ses-1_S3.png", "A2": "assets/sub-121050_ses-1_A2.png", "A3": "assets/sub-121050_ses-1_A3.png"}}, {"sub": "sub-121085", "ses": "ses-1", "images": {"S1": "assets/sub-121085_ses-1_S1.png", "S3": "assets/sub-121085_ses-1_S3.png", "A2": "assets/sub-121085_ses-1_A2.png", "A3": "assets/sub-121085_ses-1_A3.png"}}, {"sub": "sub-121407", "ses": "ses-1", "images": {"S1": "assets/sub-121407_ses-1_S1.png", "S3": "assets/sub-121407_ses-1_S3.png", "A2": "assets/sub-121407_ses-1_A2.png", "A3": "assets/sub-121407_ses-1_A3.png"}}, {"sub": "sub-121476", "ses": "ses-1", "images": {"S1": "assets/sub-121476_ses-1_S1.png", "S3": "assets/sub-121476_ses-1_S3.png", "A2": "assets/sub-121476_ses-1_A2.png", "A3": "assets/sub-121476_ses-1_A3.png"}}, {"sub": "sub-121670", "ses": "ses-1", "images": {"S1": "assets/sub-121670_ses-1_S1.png", "S3": "assets/sub-121670_ses-1_S3.png", "A2": "assets/sub-121670_ses-1_A2.png", "A3": "assets/sub-121670_ses-1_A3.png"}}, {"sub": "sub-122522", "ses": "ses-1", "images": {"S1": "assets/sub-122522_ses-1_S1.png", "S3": "assets/sub-122522_ses-1_S3.png", "A2": "assets/sub-122522_ses-1_A2.png", "A3": "assets/sub-122522_ses-1_A3.png"}}, {"sub": "sub-122528", "ses": "ses-1", "images": {"S1": "assets/sub-122528_ses-1_S1.png", "S3": "assets/sub-122528_ses-1_S3.png", "A2": "assets/sub-122528_ses-1_A2.png", "A3": "assets/sub-122528_ses-1_A3.png"}}, {"sub": "sub-122801", "ses": "ses-1", "images": {"S1": "assets/sub-122801_ses-1_S1.png", "S3": "assets/sub-122801_ses-1_S3.png", "A2": "assets/sub-122801_ses-1_A2.png", "A3": "assets/sub-122801_ses-1_A3.png"}}, {"sub": "sub-122916", "ses": "ses-1", "images": {"S1": "assets/sub-122916_ses-1_S1.png", "S3": "assets/sub-122916_ses-1_S3.png", "A2": "assets/sub-122916_ses-1_A2.png", "A3": "assets/sub-122916_ses-1_A3.png"}}, {"sub": "sub-125511", "ses": "ses-1", "images": {"S1": "assets/sub-125511_ses-1_S1.png", "S3": "assets/sub-125511_ses-1_S3.png", "A2": "assets/sub-125511_ses-1_A2.png", "A3": "assets/sub-125511_ses-1_A3.png"}}, {"sub": "sub-125535", "ses": "ses-1", "images": {"S1": "assets/sub-125535_ses-1_S1.png", "S3": "assets/sub-125535_ses-1_S3.png", "A2": "assets/sub-125535_ses-1_A2.png", "A3": "assets/sub-125535_ses-1_A3.png"}}, {"sub": "sub-125554", "ses": "ses-1", "images": {"S1": "assets/sub-125554_ses-1_S1.png", "S3": "assets/sub-125554_ses-1_S3.png", "A2": "assets/sub-125554_ses-1_A2.png", "A3": "assets/sub-125554_ses-1_A3.png"}}, {"sub": "sub-126176", "ses": "ses-1", "images": {"S1": "assets/sub-126176_ses-1_S1.png", "S3": "assets/sub-126176_ses-1_S3.png", "A2": "assets/sub-126176_ses-1_A2.png", "A3": "assets/sub-126176_ses-1_A3.png"}}, {"sub": "sub-126389", "ses": "ses-1", "images": {"S1": "assets/sub-126389_ses-1_S1.png", "S3": "assets/sub-126389_ses-1_S3.png", "A2": "assets/sub-126389_ses-1_A2.png", "A3": "assets/sub-126389_ses-1_A3.png"}}, {"sub": "sub-126554", "ses": "ses-1", "images": {"S1": "assets/sub-126554_ses-1_S1.png", "S3": "assets/sub-126554_ses-1_S3.png", "A2": "assets/sub-126554_ses-1_A2.png", "A3": "assets/sub-126554_ses-1_A3.png"}}, {"sub": "sub-126903", "ses": "ses-1", "images": {"S1": "assets/sub-126903_ses-1_S1.png", "S3": "assets/sub-126903_ses-1_S3.png", "A2": "assets/sub-126903_ses-1_A2.png", "A3": "assets/sub-126903_ses-1_A3.png"}}, {"sub": "sub-126921", "ses": "ses-1", "images": {"S1": "assets/sub-126921_ses-1_S1.png", "S3": "assets/sub-126921_ses-1_S3.png", "A2": "assets/sub-126921_ses-1_A2.png", "A3": "assets/sub-126921_ses-1_A3.png"}}, {"sub": "sub-127008", "ses": "ses-1", "images": {"S1": "assets/sub-127008_ses-1_S1.png", "S3": "assets/sub-127008_ses-1_S3.png", "A2": "assets/sub-127008_ses-1_A2.png", "A3": "assets/sub-127008_ses-1_A3.png"}}, {"sub": "sub-127236", "ses": "ses-1", "images": {"S1": "assets/sub-127236_ses-1_S1.png", "S3": "assets/sub-127236_ses-1_S3.png", "A2": "assets/sub-127236_ses-1_A2.png", "A3": "assets/sub-127236_ses-1_A3.png"}}, {"sub": "sub-127305", "ses": "ses-1", "images": {"S1": "assets/sub-127305_ses-1_S1.png", "S3": "assets/sub-127305_ses-1_S3.png", "A2": "assets/sub-127305_ses-1_A2.png", "A3": "assets/sub-127305_ses-1_A3.png"}}, {"sub": "sub-127417", "ses": "ses-1", "images": {"S1": "assets/sub-127417_ses-1_S1.png", "S3": "assets/sub-127417_ses-1_S3.png", "A2": "assets/sub-127417_ses-1_A2.png", "A3": "assets/sub-127417_ses-1_A3.png"}}, {"sub": "sub-127542", "ses": "ses-1", "images": {"S1": "assets/sub-127542_ses-1_S1.png", "S3": "assets/sub-127542_ses-1_S3.png", "A2": "assets/sub-127542_ses-1_A2.png", "A3": "assets/sub-127542_ses-1_A3.png"}}, {"sub": "sub-127611", "ses": "ses-1", "images": {"S1": "assets/sub-127611_ses-1_S1.png", "S3": "assets/sub-127611_ses-1_S3.png", "A2": "assets/sub-127611_ses-1_A2.png", "A3": "assets/sub-127611_ses-1_A3.png"}}, {"sub": "sub-128061", "ses": "ses-1", "images": {"S1": "assets/sub-128061_ses-1_S1.png", "S3": "assets/sub-128061_ses-1_S3.png", "A2": "assets/sub-128061_ses-1_A2.png", "A3": "assets/sub-128061_ses-1_A3.png"}}, {"sub": "sub-128154", "ses": "ses-1", "images": {"S1": "assets/sub-128154_ses-1_S1.png", "S3": "assets/sub-128154_ses-1_S3.png", "A2": "assets/sub-128154_ses-1_A2.png", "A3": "assets/sub-128154_ses-1_A3.png"}}, {"sub": "sub-129354", "ses": "ses-1", "images": {"S1": "assets/sub-129354_ses-1_S1.png", "S3": "assets/sub-129354_ses-1_S3.png", "A2": "assets/sub-129354_ses-1_A2.png", "A3": "assets/sub-129354_ses-1_A3.png"}}, {"sub": "sub-129405", "ses": "ses-1", "images": {"S1": "assets/sub-129405_ses-1_S1.png", "S3": "assets/sub-129405_ses-1_S3.png", "A2": "assets/sub-129405_ses-1_A2.png", "A3": "assets/sub-129405_ses-1_A3.png"}}, {"sub": "sub-129552", "ses": "ses-1", "images": {"S1": "assets/sub-129552_ses-1_S1.png", "S3": "assets/sub-129552_ses-1_S3.png", "A2": "assets/sub-129552_ses-1_A2.png", "A3": "assets/sub-129552_ses-1_A3.png"}}, {"sub": "sub-129720", "ses": "ses-1", "images": {"S1": "assets/sub-129720_ses-1_S1.png", "S3": "assets/sub-129720_ses-1_S3.png", "A2": "assets/sub-129720_ses-1_A2.png", "A3": "assets/sub-129720_ses-1_A3.png"}}, {"sub": "sub-129886", "ses": "ses-1", "images": {"S1": "assets/sub-129886_ses-1_S1.png", "S3": "assets/sub-129886_ses-1_S3.png", "A2": "assets/sub-129886_ses-1_A2.png", "A3": "assets/sub-129886_ses-1_A3.png"}}, {"sub": "sub-129926", "ses": "ses-1", "images": {"S1": "assets/sub-129926_ses-1_S1.png", "S3": "assets/sub-129926_ses-1_S3.png", "A2": "assets/sub-129926_ses-1_A2.png", "A3": "assets/sub-129926_ses-1_A3.png"}}, {"sub": "sub-130121", "ses": "ses-1", "images": {"S1": "assets/sub-130121_ses-1_S1.png", "S3": "assets/sub-130121_ses-1_S3.png", "A2": "assets/sub-130121_ses-1_A2.png", "A3": "assets/sub-130121_ses-1_A3.png"}}, {"sub": "sub-130211", "ses": "ses-1", "images": {"S1": "assets/sub-130211_ses-1_S1.png", "S3": "assets/sub-130211_ses-1_S3.png", "A2": "assets/sub-130211_ses-1_A2.png", "A3": "assets/sub-130211_ses-1_A3.png"}}, {"sub": "sub-130687", "ses": "ses-1", "images": {"S1": "assets/sub-130687_ses-1_S1.png", "S3": "assets/sub-130687_ses-1_S3.png", "A2": "assets/sub-130687_ses-1_A2.png", "A3": "assets/sub-130687_ses-1_A3.png"}}, {"sub": "sub-130759", "ses": "ses-1", "images": {"S1": "assets/sub-130759_ses-1_S1.png", "S3": "assets/sub-130759_ses-1_S3.png", "A2": "assets/sub-130759_ses-1_A2.png", "A3": "assets/sub-130759_ses-1_A3.png"}}, {"sub": "sub-130896", "ses": "ses-1", "images": {"S1": "assets/sub-130896_ses-1_S1.png", "S3": "assets/sub-130896_ses-1_S3.png", "A2": "assets/sub-130896_ses-1_A2.png", "A3": "assets/sub-130896_ses-1_A3.png"}}, {"sub": "sub-131224", "ses": "ses-1", "images": {"S1": "assets/sub-131224_ses-1_S1.png", "S3": "assets/sub-131224_ses-1_S3.png", "A2": "assets/sub-131224_ses-1_A2.png", "A3": "assets/sub-131224_ses-1_A3.png"}}, {"sub": "sub-131867", "ses": "ses-1", "images": {"S1": "assets/sub-131867_ses-1_S1.png", "S3": "assets/sub-131867_ses-1_S3.png", "A2": "assets/sub-131867_ses-1_A2.png", "A3": "assets/sub-131867_ses-1_A3.png"}}, {"sub": "sub-132179", "ses": "ses-1", "images": {"S1": "assets/sub-132179_ses-1_S1.png", "S3": "assets/sub-132179_ses-1_S3.png", "A2": "assets/sub-132179_ses-1_A2.png", "A3": "assets/sub-132179_ses-1_A3.png"}}, {"sub": "sub-132224", "ses": "ses-1", "images": {"S1": "assets/sub-132224_ses-1_S1.png", "S3": "assets/sub-132224_ses-1_S3.png", "A2": "assets/sub-132224_ses-1_A2.png", "A3": "assets/sub-132224_ses-1_A3.png"}}, {"sub": "sub-132657", "ses": "ses-1", "images": {"S1": "assets/sub-132657_ses-1_S1.png", "S3": "assets/sub-132657_ses-1_S3.png", "A2": "assets/sub-132657_ses-1_A2.png", "A3": "assets/sub-132657_ses-1_A3.png"}}, {"sub": "sub-133220", "ses": "ses-1", "images": {"S1": "assets/sub-133220_ses-1_S1.png", "S3": "assets/sub-133220_ses-1_S3.png", "A2": "assets/sub-133220_ses-1_A2.png", "A3": "assets/sub-133220_ses-1_A3.png"}}, {"sub": "sub-139272", "ses": "ses-1", "images": {"S1": "assets/sub-139272_ses-1_S1.png", "S3": "assets/sub-139272_ses-1_S3.png", "A2": "assets/sub-139272_ses-1_A2.png", "A3": "assets/sub-139272_ses-1_A3.png"}}];
    const VIEWS = ["S1", "S3", "A2", "A3"];
    let PREFILL = {}; // key: `${sub}|${ses}` -> { view: score }

    function escapeCsv(val) {
      if (val == null) return '';
      const s = String(val);
      if (s.includes('"') || s.includes(',') || s.includes('\n')) {
        return '"' + s.replace(/"/g, '""') + '"';
      }
      return s;
    }

    function toCSV() {
      const headers = ['subid','sesid', ...VIEWS.map(v => v + '_score')];
      const lines = [headers.join(',')];
      const cards = document.querySelectorAll('[data-card]');
      for (const card of cards) {
        const sub = card.getAttribute('data-sub');
        const ses = card.getAttribute('data-ses');
        const scores = VIEWS.map(v => {
          const el = card.querySelector(`[data-score="${v}"]`);
          return el ? el.value : '';
        });
        const row = [sub, ses, ...scores].map(escapeCsv).join(',');
        lines.push(row);
      }
      return lines.join('\n');
    }

    function parseCSV(text) {
      const rows = [];
      let i = 0, field = '', inQuotes = false, row = [];
      while (i < text.length) {
        const c = text[i++];
        if (inQuotes) {
          if (c === '"') {
            if (text[i] === '"') { field += '"'; i++; } else { inQuotes = false; }
          } else {
            field += c;
          }
        } else {
          if (c === '"') { inQuotes = true; }
          else if (c === ',') { row.push(field); field=''; }
          else if (c === '\n' || c === '\r') {
            if (c === '\r' && text[i] === '\n') i++;
            row.push(field); rows.push(row); row = []; field='';
          } else { field += c; }
        }
      }
      if (field.length || row.length) { row.push(field); rows.push(row); }
      return rows.filter(r => r.length && r.some(x => x !== ''));
    }

    function buildPrefillFromCSV(rows) {
      if (!rows || rows.length < 2) return {};
      const header = rows[0];
      const subIdx = header.indexOf('subid');
      const sesIdx = header.indexOf('sesid');
      const viewIdx = Object.fromEntries(VIEWS.map(v => [v, header.indexOf(v + '_score')]));
      const map = {};
      for (let r = 1; r < rows.length; r++) {
        const row = rows[r];
        const sub = row[subIdx];
        const ses = row[sesIdx];
        if (!sub || !ses) continue;
        const key = `${sub}|${ses}`;
        map[key] = map[key] || {};
        for (const v of VIEWS) {
          const idx = viewIdx[v];
          if (idx >= 0 && row[idx] !== undefined && row[idx] !== '') {
            map[key][v] = String(row[idx]);
          }
        }
      }
      return map;
    }

    function applyPrefill(prefill) {
      const cards = document.querySelectorAll('[data-card]');
      let applied = 0;
      for (const card of cards) {
        const sub = card.getAttribute('data-sub');
        const ses = card.getAttribute('data-ses');
        const key = `${sub}|${ses}`;
        const views = prefill[key];
        if (!views) continue;
        for (const v of VIEWS) {
          const val = views[v];
          if (val === undefined) continue;
          const sel = card.querySelector(`[data-score="${v}"]`);
          if (sel) { sel.value = val; applied++; }
        }
      }
      return applied;
    }

    function onCsvSelected(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const text = e.target.result;
        const rows = parseCSV(text);
        PREFILL = buildPrefillFromCSV(rows);
        const n = applyPrefill(PREFILL);
        const msg = document.getElementById('resumeMsg');
        if (msg) msg.textContent = `Applied ${n} ratings from CSV`;
      };
      reader.readAsText(file);
    }

    function render(filter='') {
      const root = document.getElementById('root');
      root.innerHTML = '';
      const q = filter.trim().toLowerCase();
      const rows = DATA.filter(r => (r.sub + ' ' + r.ses).toLowerCase().includes(q));
      for (const row of rows) {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-card', '');
        card.setAttribute('data-sub', row.sub);
        card.setAttribute('data-ses', row.ses);

        const header = document.createElement('div');
        header.className = 'header';
        const title = document.createElement('div');
        title.innerHTML = `<strong>${row.sub}</strong> &nbsp; <span class="muted">${row.ses}</span>`;
        const hint = document.createElement('div');
        hint.className = 'muted';
        hint.textContent = 'Rate each view: 0=Fail, 1=Pass';
        header.appendChild(title);
        header.appendChild(hint);
        card.appendChild(header);

        const views = document.createElement('div');
        views.className = 'views';
        for (const v of VIEWS) {
          const box = document.createElement('div');
          box.className = 'view';
          const img = document.createElement('img');
          const src = row.images[v] || '';
          if (src) img.src = src;
          img.alt = `${row.sub} ${row.ses} ${v}`;
          const label = document.createElement('label');
          label.textContent = v;
          const select = document.createElement('select');
          select.setAttribute('data-score', v);
          for (const [val, name] of [['', ''], ['0','Fail'], ['1','Pass']]) {
            const opt = document.createElement('option');
            opt.value = val; opt.textContent = name;
            select.appendChild(opt);
          }
          const rating = document.createElement('div');
          rating.className = 'rating';
          rating.appendChild(label);
          rating.appendChild(select);
          box.appendChild(img);
          box.appendChild(rating);
          views.appendChild(box);
        }
        card.appendChild(views);
        root.appendChild(card);
      }
      document.getElementById('count').textContent = rows.length + ' rows';
    }

    window.addEventListener('DOMContentLoaded', () => {
      const search = document.getElementById('search');
      search.addEventListener('input', () => render(search.value));
      const csv = document.getElementById('csvUpload');
      csv.addEventListener('change', () => { if (csv.files && csv.files[0]) onCsvSelected(csv.files[0]); });
      render('');
    });
    </script>
</head>
<body>
  <h1>T1 QC Ratings</h1>
  <div class="controls">
    <input id="search" class="search" type="search" placeholder="Filter by subject/session (e.g., sub-123 ses-1)" />
    <button class="primary" onclick="downloadCSV()">Download CSV</button>
    <input id="csvUpload" type="file" accept=".csv,text/csv" />
    <span id="resumeMsg" class="muted"></span>
    <span id="count" class="muted"></span>
  </div>
  <div id="root" class="grid"></div>
</body>
</html>
